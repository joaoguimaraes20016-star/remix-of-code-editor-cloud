<!DOCTYPE html>
<html>
<head>
  <title>Google Sheets Connected</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      margin: 0;
      background: #1a1a2e;
      color: #fff;
    }
    .container {
      text-align: center;
      padding: 2rem;
    }
    .spinner {
      width: 48px;
      height: 48px;
      border: 4px solid rgba(255,255,255,0.1);
      border-left-color: #4285f4;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 1rem;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    .success {
      color: #34a853;
    }
    .error {
      color: #ea4335;
    }
    h2 {
      margin: 0 0 0.5rem;
    }
    p {
      margin: 0;
      opacity: 0.8;
    }
  </style>
</head>
<body>
  <div class="container" id="content">
    <div class="spinner"></div>
    <h2>Connecting Google Sheets...</h2>
    <p>Please wait</p>
  </div>
  <script>
    (function() {
      const params = new URLSearchParams(window.location.search);
      const success = params.get('success') === 'true';
      const error = params.get('error');
      const email = params.get('email');
      
      const container = document.getElementById('content');
      
      if (success) {
        container.innerHTML = `
          <div class="success">
            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
              <polyline points="22,4 12,14.01 9,11.01"/>
            </svg>
          </div>
          <h2>Successfully Connected!</h2>
          <p>${email ? 'Connected as: ' + email : 'Google Sheets is now connected.'}</p>
          <p style="margin-top: 1rem; opacity: 0.6;">This window will close automatically...</p>
        `;
        
        // Notify parent window
        if (window.opener) {
          window.opener.postMessage({ type: 'google-oauth-success', email }, '*');
        }
        
        // Auto-close after delay
        setTimeout(() => window.close(), 2000);
      } else {
        const errorMessage = error === 'access_denied' 
          ? 'You denied access to Google Sheets'
          : error || 'An unknown error occurred';
          
        container.innerHTML = `
          <div class="error">
            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"/>
              <line x1="15" y1="9" x2="9" y2="15"/>
              <line x1="9" y1="9" x2="15" y2="15"/>
            </svg>
          </div>
          <h2>Connection Failed</h2>
          <p>${errorMessage}</p>
          <p style="margin-top: 1rem; opacity: 0.6;">You can close this window and try again.</p>
        `;
        
        // Notify parent window of failure
        if (window.opener) {
          window.opener.postMessage({ type: 'google-oauth-error', error: errorMessage }, '*');
        }
      }
    })();
  </script>
</body>
</html>
